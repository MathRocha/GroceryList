<header>
  <mat-toolbar id="header-toolbar">
    <h1>Grocery List</h1>

    <button matIconButton (click)="toggleMode()">
      @if (lightMode) {
      <mat-icon>dark_mode</mat-icon>
      } @else {
      <mat-icon>light_mode</mat-icon>
      }
    </button>
  </mat-toolbar>
</header>

<main>
  <mat-accordion>
    @for (itemGroup of itemsArray.controls; track itemGroup; let isFirstItem =
    $first ) {
    <mat-expansion-panel [expanded]="isFirstItem">
      <mat-expansion-panel-header
        [class]="itemGroup.valid ? '' : 'invalid-panel'"
      >
        <mat-panel-title>
          {{ itemGroup.get("name")?.value || "Item" }}
        </mat-panel-title>
        <mat-panel-description>
          {{
            itemGroup.get("total")?.value
              ? "Total: " + (itemGroup.get("total")?.value | currency)
              : ""
          }}
        </mat-panel-description>
      </mat-expansion-panel-header>

      <form [formGroup]="itemGroup">
        <mat-form-field class="item-form-field">
          <mat-label>Item</mat-label>
          <input matInput placeholder="Ex. Milk" formControlName="name" />
          @if(itemGroup.get('name')?.hasError('required')) {
          <mat-error>Item is required</mat-error>
          }
        </mat-form-field>

        <div class="amount-price">
          <mat-form-field>
            <mat-label>Amount</mat-label>
            <input
              matInput
              placeholder="Ex. 2"
              type="number"
              formControlName="amount"
            />
            @if(itemGroup.get('amount')?.hasError('required')) {
            <mat-error>Amount is required</mat-error>
            }
          </mat-form-field>

          <mat-form-field>
            <mat-label>Price</mat-label>
            <span matTextPrefix>$</span>
            <input
              matInput
              placeholder="Ex. 10.50"
              type="number"
              formControlName="price"
            />
            @if(itemGroup.get('price')?.hasError('required')) {
            <mat-error>Price is required</mat-error>
            }
          </mat-form-field>
        </div>
      </form>
    </mat-expansion-panel>
    }
  </mat-accordion>
</main>

<footer>
  <mat-toolbar id="footer-toolbar">
    <mat-toolbar-row>
      Total: {{ itemsForm.get("total")!.value | currency }}
    </mat-toolbar-row>
    <mat-toolbar-row id="toolbar-buttons-row">
      <button matButton="filled" (click)="clearList()">Clear list</button>
      <button matButton="filled" (click)="addItem()">Add item</button>
    </mat-toolbar-row>
  </mat-toolbar>
</footer>
